<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="Cache-Control" content="no-transform"/>
    <link rel="shortcut icon" href="asset/img/favicon.ico" type="image/vnd.microsoft.icon">



    <title>
      
    [JAVA安全]Spring Expression Language（SpEL） - 蓝色骨头
    
    </title>


  <link href="asset/css/style.css" rel="stylesheet" > 
  <link href="asset/js/xcode.min.css" rel="stylesheet">
  <script src="asset/js/headroom.js"></script>

  <!-- <link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="asset/css/font-awesome.css">
  media/15157608604305/favicon.ico
 -->

  <!-- <script src="asset/highlightjs/highlight.pack.js"></script> -->
  <!-- <link href="asset/highlightjs/styles/solarized_light.css" media="screen, projection" rel="stylesheet" type="text/css"> -->
  <!-- <script>hljs.initHighlightingOnLoad();</script> -->


  </head>

  <!-- 主体开始 -->
  <!-- <body class="" gtools_scp_screen_capture_injected="true"> -->
  <!-- 上面为主页白底色版本 -->
    
<body class="bg-grey" gtools_scp_screen_capture_injected="true" data-feedly-mini="yes">
<!-- 上面是主页灰底色版本 -->

<!--[if lt IE 8]>
<div class="browsehappy" role="dialog">
    当前网页 <strong>不支持</strong> 你正在使用的浏览器. 为了正常的访问, 请 <a href="http://browsehappy.com/" target="_blank">升级你的浏览器</a>。
</div>
<![endif]-->
<!-- 头部位置 -->

<header id="header" class="header bg-white headroom">
  <div class="navbar-container"> 
    <a href="index.html" class="navbar-logo"><img src="asset/img/langu.JPG"> </a>
    <div class="navbar-menu"> 

        
        <a href="index.html">主页</a>
        
        <a href="archives.html">归类</a>
        
        <a href="about.html">蓝色骨头</a>
        
        
    </div> 
    <!-- 搜索框体 -->
    <!--  <div class="navbar-search" onclick="">
        <span class="icon-search"></span>
        <form id="search" method="post" action="/" role="search">
          <span class="search-box">
            <input type="text" id="input" class="input" name="s" required="true" placeholder="Search..." maxlength="30" autocomplete="off">
          </span>
        </form>
    </div> -->

    <div class="navbar-mobile-menu" onclick=""> 
      <span class="icon-menu cross"><span class="middle"></span></span> 
        <ul> 
          
          <li>
          <a href="index.html">主页</a>
          </li>
          
          <li>
          <a href="archives.html">归类</a>
          </li>
          
          <li>
          <a href="about.html">蓝色骨头</a>
          </li>
          
        </ul> 
    </div> 
  </div> 
</header>
<!-- 头部结束 --> <!-- post 开始 -->
<div class="bg-white" gtools_scp_screen_capture_injected="true" data-feedly-mini="yes">
	<article class="main-content page-page" style="max-width: 700px;padding: 110px 25px 20px" itemscope="" itemtype="http://schema.org/Article">
		<div class="post-header">
			<!-- title -->
			<div class="post-header">
				<h1 class="post-title itemprop="name headline">[JAVA安全]Spring Expression Language（SpEL）</h1>	
				<div class="post-data">
					<time datetime="2018-04-10T10:44:13+08:00" pubdate data-updated="true">2018/04/10</time>
				</div>
			</div>
		</div>
	<div id="post-content" class="post-content" itemprop="articleBody"> 
		<p class="post-tags"> 
		
		<a href='JAVA%E5%AE%89%E5%85%A8.html'>JAVA安全</a>&nbsp;
		
		</p>
	<!-- 正文 -->
		<p>
		<p>SpEL（Spring Expression Language）是Spring提供的一种表达式语言</p>

<span id="more"></span><!-- more -->

<h3 id="toc_0">0x00 简介</h3>

<p><code>SpEL（Spring Expression Language）是Spring提供的一种表达式语言</code></p>

<p><code>能在运行时构建复杂表达式、存取对象图属性、对象方法调用等，并且能与Spring功能完美整合，如能用来配置Bean定义</code></p>

<p><code>表达式语言给静态Java语言增加了动态功能</code></p>

<h3 id="toc_1">0x01 表达式执行步骤</h3>

<p>SpEL求表达式值时的步骤</p>

<pre><code class="language-text">1、构造一个解析器
    SpEL使用ExpressionParser接口表示解析器，提供SpelExpressionParser默认实现
2、解析器解析字符串表达式
    使用ExpressionParser的parseExpression来解析相应的表达式为Expression对象
3、构造上下文
    准备比如变量定义等等表达式需要的上下文数据
4、根据上下文得到表达式运算后的值
    通过Expression接口的getValue方法根据上下文获得表达式值
</code></pre>

<pre><code class="language-text">ExpressionParser parser = new SpelExpressionParser(); （1）
Expression exp = parser.parseExpression(&quot;&#39;Hello World&#39;&quot;); （2）
String message = (String) exp.getValue(); （4）


ExpressionParser parser = new SpelExpressionParser();    (1)
Expression expression = parser.parseExpression(&quot;(&#39;Hello&#39; + &#39; World&#39;).concat(#end)&quot;);   (2) 
EvaluationContext context = new StandardEvaluationContext();    (3)
context.setVariable(&quot;end&quot;, &quot;!&quot;);    
Assert.assertEquals(&quot;Hello World!&quot;, expression.getValue(context));   (4) 

</code></pre>

<h3 id="toc_2">0x02 工作原理</h3>

<p><img src="media/15238466534248/15238470717386.jpg" alt=""/></p>

<h3 id="toc_3">0x03 主要接口</h3>

<h4 id="toc_4">EvaluationContext</h4>

<p>表示上下文环境<br/>
默认实现是org.springframework.expression.spel.support包中的StandardEvaluationContext类<br/>
使用setRootObject方法来设置根对象，使用setVariable方法来注册自定义变量，使用registerFunction来注册自定义函数等</p>

<p>下例表达式name表示对应EvaluationContext的rootObject的一个属性</p>

<pre><code class="language-text">public void EvaluationContextTest() {
    Object user = new Object() {
        public String getName() {
            return &quot;abc&quot;;
        }
    };
    EvaluationContext context = new StandardEvaluationContext(user);
    ExpressionParser parser = new SpelExpressionParser();
    Assert.assertTrue(parser.parseExpression(&quot;name&quot;).getValue(context, String.class).equals(&quot;abc&quot;));
    Assert.assertTrue(parser.parseExpression(&quot;getName()&quot;).getValue(context, String.class).equals(&quot;abc&quot;));
}
</code></pre>

<h4 id="toc_5">ExpressionParser</h4>

<p>表示解析器<br/>
默认实现是org.springframework.expression.spel.standard包中的SpelExpressionParser类，使用parseExpression方法将字符串表达式转换为Expression对象<br/>
对于ParserContext接口用于定义字符串表达式是不是模板，及模板开始与结束字符</p>

<pre><code class="language-text">public interface ExpressionParser {    
    Expression parseExpression(String expressionString);    
    Expression parseExpression(String expressionString, ParserContext context);    
}  


public void testParserContext() {    
    ExpressionParser parser = new SpelExpressionParser();    
    ParserContext parserContext = new ParserContext() {    
        @Override    
         public boolean isTemplate() {    
            return true;    
        }    
        @Override    
        public String getExpressionPrefix() {    
            return &quot;#{&quot;;    
        }    
        @Override    
        public String getExpressionSuffix() {    
            return &quot;}&quot;;    
        }    
    };    
    String template = &quot;#{&#39;Hello &#39;}#{&#39;World!&#39;}&quot;;    
    Expression expression = parser.parseExpression(template, parserContext);    
    Assert.assertEquals(&quot;Hello World!&quot;, expression.getValue());    
}  
</code></pre>

<h4 id="toc_6">Expression</h4>

<p>表示表达式对象<br/>
默认实现是org.springframework.expression.spel.standard包中的SpelExpression<br/>
提供getValue方法用于获取表达式值，提供setValue方法用于设置对象值</p>

<pre><code class="language-text">ExpressionParser parser = new SpelExpressionParser();    (1)
Expression expression = parser.parseExpression(&quot;(&#39;Hello&#39; + &#39; World&#39;).concat(#end)&quot;);   (2) 
EvaluationContext context = new StandardEvaluationContext();    (3)
context.setVariable(&quot;end&quot;, &quot;!&quot;);    
Assert.assertEquals(&quot;Hello World!&quot;, expression.getValue(context));   (4) 
</code></pre>

<h3 id="toc_7">0x04 主要功能</h3>

<pre><code class="language-text">Literal expressions

Boolean and relational operators

Regular expressions

Class expressions

Accessing properties, arrays, lists, maps

Method invocation

Relational operators

Assignment

Calling constructors

Bean references

Array construction

Inline lists

Ternary operator

Variables

User defined functions

Collection projection

Collection selection

Templated expressions
</code></pre>

<p>参考：<br/>
<a href="https://docs.spring.io/spring/docs/3.0.x/reference/expressions.html">https://docs.spring.io/spring/docs/3.0.x/reference/expressions.html</a> <br/>
<a href="https://blog.csdn.net/zhoudaxia/article/details/38174169">https://blog.csdn.net/zhoudaxia/article/details/38174169</a><br/>
<a href="https://github.com/elim168/elim168.github.io/blob/master/spring/bean/23.spel%E8%A1%A8%E8%BE%BE%E5%BC%8F.md">https://github.com/elim168/elim168.github.io/blob/master/spring/bean/23.spel%E8%A1%A8%E8%BE%BE%E5%BC%8F.md</a></p>

		</p>
		<!-- 侧边导航条 -->
		<div id="directory-content" class="directory-content">
    		<div id="directory" style="margin-left: 50px;margin-top: 120px"></div>
		</div>
	<!-- JS -->
	<script>
		var postDirectoryBuild = function() {
		    var postChildren = function children(childNodes, reg) {
		        var result = [],
		            isReg = typeof reg === 'object',
		            isStr = typeof reg === 'string',
		            node, i, len;
		        for (i = 0, len = childNodes.length; i < len; i++) {
		            node = childNodes[i];
		            if ((node.nodeType === 1 || node.nodeType === 9) &&
		                (!reg ||
		                isReg && reg.test(node.tagName.toLowerCase()) ||
		                isStr && node.tagName.toLowerCase() === reg)) {
		                result.push(node);
		            }
		        }
		        return result;
		    },
		    createPostDirectory = function(article, directory, isDirNum) {
		        var contentArr = [],
		            titleId = [],
		            levelArr, root, level,
		            currentList, list, li, link, i, len;
		        levelArr = (function(article, contentArr, titleId) {
		            var titleElem = postChildren(article.childNodes, /^h\d$/),
		                levelArr = [],
		                lastNum = 1,
		                lastRevNum = 1,
		                count = 0,
		                guid = 1,
		                id = 'directory' + (Math.random() + '').replace(/\D/, ''),
		                lastRevNum, num, elem;
		            while (titleElem.length) {
		                elem = titleElem.shift();
		                contentArr.push(elem.innerHTML);
		                num = +elem.tagName.match(/\d/)[0];
		                if (num > lastNum) {
		                    levelArr.push(1);
		                    lastRevNum += 1;
		                } else if (num === lastRevNum ||
		                    num > lastRevNum && num <= lastNum) {
		                    levelArr.push(0);
		                    lastRevNum = lastRevNum;
		                } else if (num < lastRevNum) {
		                    levelArr.push(num - lastRevNum);
		                    lastRevNum = num;
		                }
		                count += levelArr[levelArr.length - 1];
		                lastNum = num;
		                elem.id = elem.id || (id + guid++);
		                titleId.push(elem.id);
		            }
		            if (count !== 0 && levelArr[0] === 1) levelArr[0] = 0;

		            return levelArr;
		        })(article, contentArr, titleId);
		        currentList = root = document.createElement('ul');
		        dirNum = [0];
		        for (i = 0, len = levelArr.length; i < len; i++) {
		            level = levelArr[i];
		            if (level === 1) {
		                list = document.createElement('ul');
		                if (!currentList.lastElementChild) {
		                    currentList.appendChild(document.createElement('li'));
		                }
		                currentList.lastElementChild.appendChild(list);
		                currentList = list;
		                dirNum.push(0);
		            } else if (level < 0) {
		                level *= 2;
		                while (level++) {
		                    if (level % 2) dirNum.pop();
		                    currentList = currentList.parentNode;
		                }
		            }
		            dirNum[dirNum.length - 1]++;
		            li = document.createElement('li');
		            link = document.createElement('a');
		            link.href = '#' + titleId[i];
		            link.innerHTML = !isDirNum ? contentArr[i] :
		                dirNum.join('.') + ' ' + contentArr[i] ;
		            li.appendChild(link);
		            currentList.appendChild(li);
		        }
		        directory.appendChild(root);
		    };
		    createPostDirectory(document.getElementById('post-content'),document.getElementById('directory'), true);
		};
		postDirectoryBuild();
	</script>	
	<!-- 版权声明 -->
		<p class="post-info" style="color: #BCBDB6">
				本文由 <a style="color: #BCBDB6" href="#">蓝骨
				</a> 创作，采用 <a style="color: #BCBDB6" href="https://creativecommons.org/licenses/by/4.0/" target="_blank" rel="external nofollow">知识共享署名4.0</a> 国际许可协议进行许可<br>本站文章除注明转载/出处外，均为本站原创或翻译，转载前请务必署名<br>最后编辑时间为: 2018-04-16T10:44:13+08:00
		</p>
	<!-- 导航 -->
			<div id="comments" class="clearfix" style="padding: 0px;">
				<footer class="post-footer clearfix">	    			
				    <div class="meta">
					    
					    <P style="float: left;">
					    	<a href="15236099494494.html" 
					        title="Previous Post: [漏洞分析]CVE-2018-1273: RCE with Spring Data Commons">&laquo; [漏洞分析]CVE-2018-1273: RCE with Spring Data Commons</a>
					    </p>
					    <p style="float:right; ">
					    	
					    	
					        <a href="15236105713087.html" 
					        title="Next Post: [漏洞分析]CVE-2018-1270: Remote Code Execution with spring-messaging">[漏洞分析]CVE-2018-1270: Remote Code Execution with spring-messaging &raquo;</a>
					    </p> 
					    
				    </div>
			  	</footer>
	<!-- footer end -->
			</div>		
	</div>
</article>
			<!-- 评论区 -->
			<div id="respond-post-269" class="comment-container"> 
				<div id="comments" class="clearfix">

				<script type="text/javascript" src="/pm/hashover/hashover.js"></script>
<noscript>You must have JavaScript enabled to use the comments.</noscript>

<!-- 评论区结束 -->
					<div>
					
					</div>

				</div>
			</div>
</div>
<!-- headroom -->
<script type="text/javascript"> 
(function() {
    var header = new Headroom(document.querySelector("#header"), {
        tolerance: 3,
        offset : 80,
        classes: {
          initial: "animated",
          pinned: "slideDown",
          unpinned: "slideUp"
        }
    });
    header.init();
}());
</script>  <footer id="footer" class="footer" style="background-color: #030501;color: #FFFFFE;">
  <div class="footer-meta">
    <div class="footer-container">
      <!-- 版权说明 -->
      <div class="meta-item meta-copyright">
        <div class="meta-copyright-info">
          <h2 class="meta-title">INFO</h2>
          <div class="info-text">  
              <span class="credit">Copyright © 2016
              <a target="_blank" href="https://www.uxss.net/">蓝骨</a> 
              </span>
              </p> 
          </div>                  
        </div>
      </div>  
      <!-- Categories -->
      <div class="meta-item meta-comments">
          <h2 class="meta-title">CATEGORIES</h2>  
             
            
            <li>
            <a href="WEB%E5%AE%89%E5%85%A8.html">WEB安全&nbsp;(8)</a>
            <p>
            
            </p>
            </li>
            
             
            
            <li>
            <a href="JAVA%E5%AE%89%E5%85%A8.html">JAVA安全&nbsp;(10)</a>
            <p>
            
            </p>
            </li>
            
             
            
            <li>
            <a href="PYTHON.html">PYTHON&nbsp;(2)</a>
            <p>
            
            </p>
            </li>
            
             
            
            <li>
            <a href="%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90.html">漏洞分析&nbsp;(12)</a>
            <p>
            
            </p>
            </li>
            
             
            
            </p>
            </li>
            
             
            
            </p>
            </li>
            
             
            
            </p>
            </li>
            
             
            
            </p>
            </li>
            
             
            
            </p>
            </li>
            
             
            
            </p>
            </li>
            
             
            
            </p>
            </li>
            
             
            
            </p>
            </li>
            
             
            
            </p>
            </li>
            
             
      </div>
      <!-- 最新文章 -->
      <div class="meta-item meta-comments">
          <h2 class="meta-title">RECENT POSTS</h2>

          
          
         <li>
           <a href="15996523559667.html">[安全建设]API越权风险检测方式浅谈</a><br>
         </li>
          
          
          
         <li>
           <a href="15993821624930.html">JavaParse(AST)获取Java Web API list</a><br>
         </li>
          
          
          
         <li>
           <a href="15982374410900.html">[胡思乱想]奔涌的后浪与独立思考</a><br>
         </li>
          
          
          
         <li>
           <a href="15982373638552.html">[胡思乱想]为什么我们会对新事物产生抵触心理</a><br>
         </li>
          
          
          
         <li>
           <a href="15982371852368.html">[IoT安全]2020 IoT Threat Report 解读</a><br>
         </li>
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
           

      </div>
  </div>
</div>
</footer>

<!--评论变量判断 -->
      
<!-- 评论end -->
<script src="asset/chart/all-min.js"></script><script type="text/javascript">$(function(){    var mwebii=0;    var mwebChartEleId = 'mweb-chart-ele-';    $('pre>code').each(function(){        mwebii++;        var eleiid = mwebChartEleId+mwebii;        if($(this).hasClass('language-sequence')){            var ele = $(this).addClass('nohighlight').parent();            $('<div id="'+eleiid+'"></div>').insertAfter(ele);            ele.hide();            var diagram = Diagram.parse($(this).text());            diagram.drawSVG(eleiid,{theme: 'simple'});        }else if($(this).hasClass('language-flow')){            var ele = $(this).addClass('nohighlight').parent();            $('<div id="'+eleiid+'"></div>').insertAfter(ele);            ele.hide();            var diagram = flowchart.parse($(this).text());            diagram.drawSVG(eleiid);        }    });});</script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-AMS_SVG-full"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({TeX: { equationNumbers: { autoNumber: "AMS" } }});</script>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?5cedc0509c3675ce7544f6ab75111536";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
</body>
</html>